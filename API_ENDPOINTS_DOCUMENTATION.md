# IoT Platform API Endpoints Documentation

## Base URL
- **Backend Server**: `http://20.75.50.202:8100`
- **Frontend Base URL**: `http://20.75.50.202:8100` (configured in `src/config/api.ts`)
- **External PDF Processing Service**: `http://20.75.50.202:8000`

---

## üîê Authentication Endpoints (`/auth`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| POST | `/auth/signin` | User login | ‚úÖ `authAPI.login()` |
| POST | `/auth/signup` | User registration | ‚úÖ `authAPI.register()` |
| POST | `/auth/refresh` | Refresh JWT token | ‚úÖ `authAPI.refresh()` |

---

## üë• User Management Endpoints (`/users`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/users` | Get all users | ‚úÖ `userAPI.getAll()` |
| GET | `/users/{id}` | Get user by ID | ‚úÖ `userAPI.getById()` |
| PUT | `/users/{id}` | Update user | ‚úÖ `userAPI.update()` |
| DELETE | `/users/{id}` | Delete user | ‚úÖ `userAPI.delete()` |
| GET | `/users/profile` | Get current user profile | ‚úÖ `userAPI.getProfile()` |
| POST | `/users/change-password` | Change password | ‚úÖ `userAPI.changePassword()` |

### User Preferences (`/user-preferences`)
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/user-preferences` | Get user preferences | ‚úÖ `userAPI.getPreferences()` |
| POST | `/user-preferences` | Save user preferences | ‚úÖ `userAPI.savePreferences()` |

---

## üì± Device Management Endpoints (`/api/devices`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/devices` | Get all devices | ‚úÖ `deviceAPI.getAll()` |
| GET | `/api/devices/{id}` | Get device by ID | ‚úÖ `deviceAPI.getById()` |
| POST | `/api/devices` | Create device | ‚úÖ `deviceAPI.create()` |
| POST | `/api/devices/simple` | Create simple device | ‚úÖ `deviceAPI.createSimple()` |
| POST | `/api/devices/with-files` | Create device with files | ‚ùå Not used |
| PUT | `/api/devices/{id}` | Update device | ‚úÖ `deviceAPI.update()` |
| DELETE | `/api/devices/{id}` | Delete device | ‚úÖ `deviceAPI.delete()` |
| PATCH | `/api/devices/{id}/status` | Update device status | ‚úÖ `deviceAPI.updateStatus()` |
| POST | `/api/devices/{id}/telemetry` | Send telemetry data | ‚ùå Not used |
| GET | `/api/devices/{id}/telemetry` | Get device telemetry | ‚úÖ `deviceAPI.getTelemetry()` |
| GET | `/api/devices/stats` | Get device statistics | ‚ùå Not used |
| GET | `/api/devices/{id}/documentation/{type}` | Get device documentation by type | ‚ùå Not used |
| GET | `/api/devices/{id}/documentation` | Get all device documentation | ‚úÖ `deviceAPI.getDocumentation()` |
| GET | `/api/devices/debug-db` | Debug database | ‚ùå Not used |
| GET | `/api/devices/health` | Health check | ‚úÖ Used in onboarding |
| GET | `/api/devices/debug-auth` | Debug authentication | ‚úÖ Used in onboarding |
| POST | `/api/devices/onboard-with-ai` | AI-powered device onboarding | ‚úÖ `deviceAPI.onboardWithAI()` |
| GET | `/api/devices/{id}/pdf-results` | Get PDF processing results | ‚úÖ `deviceAPI.getDevicePDFResults()` |
| GET | `/api/devices/{id}/maintenance` | Get device maintenance | ‚ùå Not used |
| GET | `/api/devices/{id}/safety-precautions` | Get device safety precautions | ‚ùå Not used |
| GET | `/api/devices/{id}/rules` | Get device rules | ‚ùå Not used |
| GET | `/api/devices/{id}/test-data` | Get test data | ‚ùå Not used |
| GET | `/api/devices/{id}/debug-data` | Get debug data | ‚úÖ `deviceAPI.getDebugData()` |
| GET | `/api/devices/auth-test` | Test authentication | ‚úÖ `deviceAPI.testAuth()` |
| GET | `/api/devices/{id}/onboarding-progress` | Get onboarding progress | ‚ùå Not used |
| GET | `/api/devices/{id}/onboarding-status` | Get onboarding status | ‚ùå Not used |
| GET | `/api/devices/maintenance/upcoming` | Get upcoming maintenance | ‚úÖ `maintenanceAPI.getUpcoming()` |

---

## üîß Rules Management Endpoints (`/api/rules`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/rules` | Get all rules | ‚úÖ `ruleAPI.getAll()` |
| GET | `/api/rules/{id}` | Get rule by ID | ‚úÖ `ruleAPI.getById()` |
| POST | `/api/rules` | Create rule | ‚úÖ `ruleAPI.create()` |
| POST | `/api/rules/bulk` | Create multiple rules | ‚úÖ `ruleAPI.createBulk()` |
| PUT | `/api/rules/{id}` | Update rule | ‚úÖ `ruleAPI.update()` |
| DELETE | `/api/rules/{id}` | Delete rule | ‚úÖ `ruleAPI.delete()` |
| PATCH | `/api/rules/{id}/toggle` | Toggle rule | ‚úÖ `ruleAPI.toggle()` |
| GET | `/api/rules/active` | Get active rules | ‚ùå Not used |
| GET | `/api/rules/stats` | Get rule statistics | ‚ùå Not used |
| GET | `/api/devices/{deviceId}/rules` | Get rules by device | ‚úÖ `ruleAPI.getByDevice()` |
| POST | `/api/rules/generate-rules` | Generate rules | ‚ùå Not used |

---

## üîß Maintenance Management Endpoints (`/api/maintenance`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/maintenance` | Get all maintenance items | ‚úÖ `maintenanceAPI.getAll()` |
| GET | `/api/maintenance/{id}` | Get maintenance by ID | ‚úÖ `maintenanceAPI.getById()` |
| POST | `/api/maintenance` | Create maintenance item | ‚úÖ `maintenanceAPI.create()` |
| POST | `/api/maintenance/bulk` | Create multiple maintenance items | ‚úÖ `maintenanceAPI.createBulk()` |
| PUT | `/api/maintenance/{id}` | Update maintenance item | ‚úÖ `maintenanceAPI.update()` |
| DELETE | `/api/maintenance/{id}` | Delete maintenance item | ‚úÖ `maintenanceAPI.delete()` |
| GET | `/api/devices/{deviceId}/maintenance` | Get maintenance by device | ‚úÖ `maintenanceAPI.getByDevice()` |

---

## üõ°Ô∏è Device Safety Precautions Endpoints (`/api/device-safety-precautions`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/device-safety-precautions/device/{deviceId}` | Get safety precautions by device | ‚úÖ `deviceSafetyPrecautionsAPI.getAllByDevice()` |
| GET | `/api/device-safety-precautions/device/{deviceId}/active` | Get active safety precautions | ‚úÖ `deviceSafetyPrecautionsAPI.getActiveByDevice()` |
| GET | `/api/device-safety-precautions/{id}` | Get safety precaution by ID | ‚úÖ `deviceSafetyPrecautionsAPI.getById()` |
| POST | `/api/device-safety-precautions` | Create safety precaution | ‚úÖ `deviceSafetyPrecautionsAPI.create()` |
| POST | `/api/device-safety-precautions/bulk` | Create multiple safety precautions | ‚úÖ `deviceSafetyPrecautionsAPI.createBulk()` |
| PUT | `/api/device-safety-precautions/{id}` | Update safety precaution | ‚úÖ `deviceSafetyPrecautionsAPI.update()` |
| DELETE | `/api/device-safety-precautions/{id}` | Delete safety precaution | ‚úÖ `deviceSafetyPrecautionsAPI.delete()` |
| DELETE | `/api/device-safety-precautions/device/{deviceId}` | Delete all safety precautions for device | ‚úÖ `deviceSafetyPrecautionsAPI.deleteByDevice()` |
| GET | `/api/device-safety-precautions/device/{deviceId}/type/{type}` | Get by type | ‚úÖ `deviceSafetyPrecautionsAPI.getByType()` |
| GET | `/api/device-safety-precautions/device/{deviceId}/category/{category}` | Get by category | ‚úÖ `deviceSafetyPrecautionsAPI.getByCategory()` |
| GET | `/api/device-safety-precautions/device/{deviceId}/severity/{severity}` | Get by severity | ‚úÖ `deviceSafetyPrecautionsAPI.getBySeverity()` |
| GET | `/api/device-safety-precautions/device/{deviceId}/count` | Get count | ‚úÖ `deviceSafetyPrecautionsAPI.getCount()` |

---

## üìÑ PDF Processing Endpoints (`/api/pdf`)

### Core Backend Endpoints:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| POST | `/api/pdf/upload` | Upload PDF file (authenticated) | ‚úÖ `pdfAPI.uploadPDF()` |
| POST | `/api/pdf/upload-pdf` | Upload PDF file (public) | ‚úÖ `pdfAPI.uploadPDFPublic()` |
| POST | `/api/pdf/query` | Query PDF content | ‚úÖ `pdfAPI.queryPDF()` |
| GET | `/api/pdf/list` | List all PDFs | ‚úÖ `pdfAPI.listPDFs()` |
| POST | `/api/pdf/generate-rules` | Generate rules from PDF | ‚úÖ `pdfAPI.generateRules()` |
| POST | `/api/pdf/generate-maintenance` | Generate maintenance from PDF | ‚úÖ `pdfAPI.generateMaintenance()` |
| POST | `/api/pdf/generate-safety` | Generate safety precautions from PDF | ‚úÖ `pdfAPI.generateSafety()` |
| DELETE | `/api/pdf/{pdfName}` | Delete PDF | ‚úÖ `pdfAPI.deletePDF()` |
| GET | `/api/pdf/download/{pdfName}` | Download PDF | ‚úÖ `pdfAPI.downloadPDF()` |
| GET | `/api/pdf/status/{pdfName}` | Get PDF processing status | ‚úÖ `pdfAPI.getPDFStatus()` |
| GET | `/api/pdf/health` | PDF service health check | ‚úÖ `pdfAPI.healthCheck()` |

### External Service Compatibility Endpoints:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/pdf/pdfs` | List PDFs (external format) | ‚úÖ `pdfAPI.listPDFsExternal()` |
| DELETE | `/api/pdf/pdfs/{pdfName}` | Delete PDF (external format) | ‚úÖ `pdfAPI.deletePDFExternal()` |
| POST | `/api/pdf/generate-rules/{pdfName}` | Generate rules (external format) | ‚úÖ `pdfAPI.generateRulesExternal()` |
| POST | `/api/pdf/generate-maintenance/{pdfName}` | Generate maintenance (external format) | ‚úÖ `pdfAPI.generateMaintenanceExternal()` |
| POST | `/api/pdf/generate-safety/{pdfName}` | Generate safety (external format) | ‚úÖ `pdfAPI.generateSafetyExternal()` |

### Debug & Utility Endpoints:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/pdf/debug/collection/{pdfName}` | Debug collection analysis | ‚úÖ `pdfAPI.debug.collectionAnalysis()` |
| POST | `/api/pdf/debug/test-query/{pdfName}` | Test query pipeline | ‚úÖ `pdfAPI.debug.testQueryPipeline()` |
| GET | `/api/pdf/debug/collections` | List all collections | ‚úÖ `pdfAPI.debug.listAllCollections()` |
| GET | `/api/pdf/debug/health` | Debug health check | ‚úÖ `pdfAPI.debug.healthCheck()` |
| GET | `/api/pdf/debug/test-images/{pdfName}` | Test images | ‚úÖ `pdfAPI.debug.testImages()` |
| GET | `/api/pdf/health/global` | Global health check | ‚úÖ `pdfAPI.globalHealthCheck()` |
| GET | `/api/pdf/info` | Service information | ‚úÖ `pdfAPI.getServiceInfo()` |

**Note**: The Knowledge Section now uses the external collections endpoint (`/api/pdf/debug/collections`) as the primary source for PDF documents, with fallback to backend PDF API and knowledge API.

---

## üîî Notification Endpoints (`/api/notifications`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/notifications` | Get all notifications | ‚úÖ `notificationAPI.getAll()` |
| POST | `/api/notifications` | Create notification | ‚úÖ `notificationAPI.create()` |
| PATCH | `/api/notifications/{id}/read` | Mark as read | ‚úÖ `notificationAPI.markAsRead()` |
| PATCH | `/api/notifications/read-all` | Mark all as read | ‚úÖ `notificationAPI.markAllAsRead()` |
| GET | `/api/notifications/unread-count` | Get unread count | ‚úÖ `notificationAPI.getUnreadCount()` |

---

## üí¨ Chat Endpoints (`/api/chat`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| POST | `/api/chat/query` | Send chat query | ‚ùå Not used |
| GET | `/api/chat/history` | Get chat history | ‚ùå Not used |
| GET | `/api/chat/history/device/{deviceId}` | Get device chat history | ‚ùå Not used |
| GET | `/api/chat/history/pdf/{pdfName}` | Get PDF chat history | ‚ùå Not used |

---

## üîó Device Connection Endpoints (`/api/device-connections`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/device-connections` | Get all connections | ‚úÖ `deviceConnectionAPI.getAll()` |
| GET | `/api/device-connections/{deviceId}` | Get connection by device ID | ‚úÖ `deviceConnectionAPI.getById()` |
| POST | `/api/device-connections` | Create connection | ‚úÖ `deviceConnectionAPI.create()` |
| PUT | `/api/device-connections/{deviceId}` | Update connection | ‚úÖ `deviceConnectionAPI.update()` |
| DELETE | `/api/device-connections/{deviceId}` | Delete connection | ‚úÖ `deviceConnectionAPI.delete()` |
| POST | `/api/device-connections/{deviceId}/connect` | Connect device | ‚úÖ `deviceConnectionAPI.connect()` |
| POST | `/api/device-connections/{deviceId}/disconnect` | Disconnect device | ‚úÖ `deviceConnectionAPI.disconnect()` |
| GET | `/api/device-connections/active` | Get active connections | ‚úÖ `deviceConnectionAPI.getActive()` |
| GET | `/api/device-connections/stats` | Get connection statistics | ‚úÖ `deviceConnectionAPI.getStats()` |

---

## ‚öôÔ∏è Conversation Configuration Endpoints (`/api/conversation-configs`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| GET | `/api/conversation-configs` | Get all configs | ‚úÖ `conversationConfigAPI.getAll()` |
| GET | `/api/conversation-configs/{id}` | Get config by ID | ‚úÖ `conversationConfigAPI.getById()` |
| POST | `/api/conversation-configs` | Create config | ‚úÖ `conversationConfigAPI.create()` |
| PUT | `/api/conversation-configs/{id}` | Update config | ‚úÖ `conversationConfigAPI.update()` |
| DELETE | `/api/conversation-configs/{id}` | Delete config | ‚úÖ `conversationConfigAPI.delete()` |
| GET | `/api/conversation-configs/active` | Get active config | ‚úÖ `conversationConfigAPI.getActive()` |
| GET | `/api/conversation-configs/platform/{platformType}` | Get by platform type | ‚úÖ `conversationConfigAPI.getByPlatformType()` |

---

## üìö Knowledge Management Endpoints (`/knowledge`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| POST | `/knowledge/upload` | Upload document | ‚ùå Not used |
| POST | `/knowledge/upload-pdf` | Upload PDF document | ‚ùå Not used |
| POST | `/knowledge/query` | Query knowledge base | ‚ùå Not used |
| GET | `/knowledge/pdfs` | Get all PDFs | ‚ùå Not used |
| GET | `/knowledge/documents` | Get all documents | ‚ùå Not used |
| GET | `/knowledge/documents/device/{deviceId}` | Get documents by device | ‚ùå Not used |
| GET | `/knowledge/documents/general` | Get general documents | ‚ùå Not used |

---

## üîî Maintenance Notification Endpoints (`/api/maintenance-notifications`)

### Backend Endpoints Available:
| Method | Endpoint | Description | Frontend Usage |
|--------|----------|-------------|----------------|
| POST | `/api/maintenance-notifications/trigger` | Trigger notification | ‚ùå Not used |
| GET | `/api/maintenance-notifications/status` | Get notification status | ‚ùå Not used |

---

## üìä Analytics Endpoints (Not Implemented in Backend)

### Frontend API Calls (No Backend Implementation):
| Method | Endpoint | Description | Status |
|--------|----------|-------------|--------|
| GET | `/api/analytics` | Get all analytics | ‚ùå Not implemented |
| GET | `/api/analytics/{id}` | Get analytics by ID | ‚ùå Not implemented |
| POST | `/api/analytics` | Create analytics | ‚ùå Not implemented |
| PUT | `/api/analytics/{id}` | Update analytics | ‚ùå Not implemented |
| DELETE | `/api/analytics/{id}` | Delete analytics | ‚ùå Not implemented |
| GET | `/api/analytics/{deviceId}/realtime` | Get real-time analytics | ‚ùå Not implemented |
| GET | `/api/analytics/{deviceId}/historical` | Get historical analytics | ‚ùå Not implemented |

---

## üìù Log Endpoints (Not Implemented in Backend)

### Frontend API Calls (No Backend Implementation):
| Method | Endpoint | Description | Status |
|--------|----------|-------------|--------|
| GET | `/api/logs` | Get all logs | ‚ùå Not implemented |
| GET | `/api/logs/{id}` | Get log by ID | ‚ùå Not implemented |
| POST | `/api/logs` | Create log | ‚ùå Not implemented |
| PUT | `/api/logs/{id}` | Update log | ‚ùå Not implemented |
| DELETE | `/api/logs/{id}` | Delete log | ‚ùå Not implemented |
| GET | `/api/logs/level/{level}` | Get logs by level | ‚ùå Not implemented |
| GET | `/api/logs/date-range` | Get logs by date range | ‚ùå Not implemented |
| GET | `/api/logs/{deviceId}/export` | Export logs | ‚ùå Not implemented |

---

## üîç Issues Found

### 1. **Missing Backend Endpoints**
- Analytics endpoints are not implemented in the backend
- Log endpoints are not implemented in the backend
- Some device endpoints are not being used in the frontend

### 2. **Endpoint Mismatches**
- Frontend calls `/api/users/profile` but backend has `/users/profile` ‚úÖ **FIXED**
- Some knowledge endpoints use `/api/knowledge` but backend uses `/knowledge`

### 3. **Unused Backend Endpoints**
- Many device endpoints are not being used in the frontend
- Chat endpoints are not being used
- Some maintenance notification endpoints are not being used

### 4. **Authentication Issues**
- Some endpoints require authentication but frontend might not be sending proper tokens
- Token refresh mechanism needs to be tested

---

## üöÄ Recommendations

### 1. **Implement Missing Backend Endpoints**
```java
// Add these controllers to the backend:
- AnalyticsController
- LogController
```

### 2. **Fix Endpoint Mismatches**
```typescript
// Update frontend API calls to match backend:
- Change `/api/knowledge/*` to `/knowledge/*` for knowledge endpoints
```

### 3. **Add Missing Frontend API Methods**
```typescript
// Add these methods to the frontend API service:
- Chat API methods
- Device telemetry sending
- Device status updates
```

### 4. **Test Authentication Flow**
```bash
# Test the authentication endpoints:
curl -X POST http://20.57.36.66:8100/auth/signin \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}'
```

### 5. **Add Health Check Endpoints**
```typescript
// Add health check to frontend:
const healthCheck = () => api.get('/api/devices/health');
```

---

## üìã Summary

- **Total Backend Endpoints**: ~80 endpoints
- **Frontend API Methods**: ~60 methods
- **Matching Endpoints**: ~50 endpoints
- **Missing Backend**: ~20 endpoints (Analytics, Logs)
- **Unused Backend**: ~15 endpoints
- **Authentication Issues**: Need to verify token handling

The main issue causing the 401 errors was the URL configuration (localhost vs VM IP) and endpoint mismatches, which have been fixed. The authentication flow should now work properly.
